#cloud-config
password: fedora
chpasswd:
  expire: False

# Tell cloud-init to log the output to a log file
output: {all: '| tee -a /var/log/cloud-init-output.log'}

# Set hostname
hostname: fedora

# Set timezone
timezone: US/Alaska

ssh_import_is: [ubuntu]
ssh_authorized_keys:
 - ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAYEAnNqVrt71AKSIMmSAIONBx4jIEK0IIZF5fSAaB9kI4oOK+t7aSTKAZwwgKHWJ536XFdR3Ql5Xi0r2CuUEf1GVEagAxLZTXRuim5UGmS63rfSxGwq9JQVg5WDbN5ilnGxSmqsD77SApvmffcO/T2zZWd+rrjMWWRi9zQwRdQRm60bc69ajJbjIJd8SCXIggUPzTkUz5Sca7dhdffcMpGR9bdexFln+YSli1ohtvs2zVBM4ncpufGS+Auax8+gQNr32QeSszlKuKsXYorZ9gl+Z8s62mX5yCXIrH2hWoHsCTUX38iVM8/wI6sPVosarkng7mPOOQLy5k50Y0cb9FRQGlrvmQqsc3fI7tC1fblhKL0HaY844kIZRHwFuOI04ik+b8Swdjed6+FH/RIKppuOY+qfdmv8gcX4ZhpbKg+JN+u5Xy5awpUFqhsbBdCz0MvLNPKEbDNCFokX8nL0HqGeABk2DOJ1+IOFz5pIiCL31LTVGTQ0AwXp3nkaHZykJNrcB Authentication from lam@laptop.lam1.us

runcmd:
 - echo
 - echo 'QEMU LAM Alaska Allow any to read /var/log/cloud-init-output.log'
 - chmod a+r /var/log/cloud-init-output.log
 - echo
 - echo 'QEMU LAM Alaska Adding a swap partition'
 - echo '/dev/sdb1 swap swap defaults 0 0' >> /etc/fstab
 - swapon --all
 - free
 - echo 'QEMU LAM swap space in use'
 - swapon -s
 - echo
 - echo 'AWS LAM Upgrade the instance'
 - dnf -y upgrade
 - echo
 - echo 'AWS LAM Install LAMipedia packages'
 - dnf -y install nfs-utils httpd httpd-manual mod_ssl whois lynx perl-CGI perl-libwww-perl xauth php-fpm php-mysqli php-json php php-devel php-gd php-mbstring php-intl php-mysqlnd php-xml mariadb-server gitweb mod_perl gtk3 perl-DBD-MySQL mlocate texlive libxkbfile xorg-x11-xbitmaps
 - echo
 - echo 'QEMU LAM Alaska Report user-data for this instance (CloudInit directives)'
 - echo
 - cat /var/lib/cloud/instances/lam0/user-data.txt
 - echo
 - echo 'QEMU LAM Alaska Adding nfs4 mount to ak20:/mnt/ak20-ext4 and ak20:/mnt/ak20-Bk'
 - mkdir /mnt/ak20-ext4 /mnt/ak20-Bk
 - echo "10.55.5.20:/mnt/ak20-ext4 /mnt/ak20-ext4 nfs4 defaults,nofail,x-systemd.device-timeout=4 0 0" >> /etc/fstab
 - echo "10.55.5.20:/mnt/ak20-Bk   /mnt/ak20-Bk   nfs4 defaults,nofail,x-systemd.device-timeout=4 0 0" >> /etc/fstab
 - mount -a -t nfs4
 - echo
 - echo 'AWS LAM Installing Amazon Linux 2 ec2-user bash resources for fedora user'
 - tar -xzf /mnt/ak20-Bk/Bk2/aws/efs/Amazon-Linux-2023/Amazom-Linux-2023-ec2-user.tgz --directory /home/fedora
 - echo
 - echo 'AWS LAM Set git user name, email for system'
 - git config --system user.name "LAMurakami"
 - git config --system user.email GitHub@LAMurakami.com
 - git config --system core.editor vi
 - git config --system branch.autosetuprebase always
 - git config --system init.defaultBranch master
 - git config --system --add safe.directory /var/www/lam
 - echo
 - echo 'AWS LAM Report kernel version'
 - uname -a
 - echo
 - echo 'AWS LAM Report Release version'
 - head /etc/*release
 - echo
 - echo 'AWS LAM Install man2html'
 - tar -xzf /mnt/ak20-Bk/Bk2/aws/efs/Amazon-Linux-2023/Amazom-Linux-2023-man2html.tgz --directory /usr/local
 - echo
 - echo 'AWS LAM Install xeyes'
 - tar -xzf /mnt/ak20-Bk/Bk2/aws/efs/Amazon-Linux-2023/Amazom-Linux-2023-xeyes.tgz --directory /usr/local
 - echo
 - echo 'AWS LAM Install xclock'
 - tar -xzf /mnt/ak20-Bk/Bk2/aws/efs/Amazon-Linux-2023/Amazom-Linux-2023-xclock.tgz --directory /usr/local
 - echo
 - echo 'AWS LAM Install xlogo'
 - tar -xzf /mnt/efs/Amazon-Linux-2023/Amazom-Linux-2023-xlogo.tgz --directory /usr/local
 - echo
 - echo 'AWS LAM Install geany'
 - tar -xzf /mnt/ak20-Bk/Bk2/aws/efs/Amazon-Linux-2023/geany.tgz --directory /usr/local
 - ldconfig /usr/local/lib
 - echo
 - echo 'AWS LAM Install glances for fedora'
 - dnf -y install glances
 - echo
